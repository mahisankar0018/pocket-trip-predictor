package com.tripcost;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@SpringBootApplication
public class TripCostEstimatorApplication {
    public static void main(String[] args) {
        SpringApplication.run(TripCostEstimatorApplication.class, args);
    }
}

@RestController
class TripUIController {

    @GetMapping("/")
    public String ui() {
        return """
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Trip cost estimator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#020617;
  color:#e5e7eb;
}
h1{text-align:center;margin:20px 0}
.container{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
  padding:20px;
}
.card{
  background:#0f172a;
  padding:20px;
  border-radius:14px;
}
input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:none;
}
button{
  background:#22c55e;
  color:#022c22;
  font-weight:bold;
  cursor:pointer;
}
#map{
  height:420px;
  margin:20px;
  border-radius:14px;
}
.hidden{display:none}
.row{
  display:flex;
  justify-content:space-between;
  margin:8px 0;
}
hr{
  border:none;
  border-top:1px dashed #334155;
  margin:12px 0;
}
</style>
</head>

<body>

<h1>Trip cost estimator</h1>

<div class="container">

<!-- INPUT SECTION -->
<div class="card">
<h3>Trip details</h3>

<input id="from" placeholder="Origin (e.g., Hyderabad)">
<input id="to" placeholder="Destination (e.g., Bengaluru)">

<button onclick="findRoute()">Find route & distance</button>

<hr>

<input id="mileage" type="number" placeholder="Vehicle mileage (km/L)" value="18">
<input id="fuelPrice" type="number" placeholder="Fuel price (‚Çπ/L)" value="110">

<input id="travellers" type="number" placeholder="Number of travellers" value="2">

<input id="hotelRate" type="number" placeholder="Hotel cost (‚Çπ per room per night)" value="1500">
<input id="nights" type="number" placeholder="Number of nights" value="1">

<input id="food" type="number" placeholder="Food cost (‚Çπ per person per day)" value="300">
<input id="extras" type="number" placeholder="Extra expenses (‚Çπ)" value="0">

<button onclick="calculateCost()">Calculate trip cost</button>
<button onclick="findHotels()">üè® Find hotels near destination</button>
</div>

<!-- RESULT SECTION -->
<div class="card hidden" id="resultCard">
<h3>Trip budget overview</h3>

<div class="row"><span>Distance</span><span><b id="rDist"></b> km</span></div>
<div class="row"><span>Fuel needed</span><span><b id="rFuel"></b> L</span></div>
<div class="row"><span>Transport cost</span><span>‚Çπ<b id="rTransport"></b></span></div>
<div class="row"><span>Stay cost</span><span>‚Çπ<b id="rStay"></b></span></div>
<div class="row"><span>Food cost</span><span>‚Çπ<b id="rFood"></b></span></div>
<div class="row"><span>Extras</span><span>‚Çπ<b id="rExtra"></b></span></div>

<hr>

<div class="row"><strong>Grand total</strong><strong>‚Çπ<b id="rTotal"></b></strong></div>
<div class="row"><strong>Per person</strong><strong>‚Çπ<b id="rPer"></b></strong></div>

<hr>
<h4>üå§ Weather</h4>
<div id="weather">No data</div>
</div>

</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let distanceKm = 0;

const map = L.map("map").setView([20.5937,78.9629],5);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
let routeLayer;

async function geo(place){
  const r = await fetch(
    "https://nominatim.openstreetmap.org/search?format=json&q="+place
  );
  const d = await r.json();
  return {lat:+d[0].lat, lon:+d[0].lon};
}

async function findRoute(){
  const A = await geo(from.value);
  const B = await geo(to.value);

  const r = await fetch(
    `https://router.project-osrm.org/route/v1/driving/${A.lon},${A.lat};${B.lon},${B.lat}?overview=full&geometries=geojson`
  );
  const data = await r.json();
  const route = data.routes[0];

  distanceKm = route.distance / 1000;

  if(routeLayer) map.removeLayer(routeLayer);
  routeLayer = L.geoJSON(route.geometry).addTo(map);
  map.fitBounds(routeLayer.getBounds());

  loadWeather(B.lat, B.lon);
}

async function loadWeather(lat,lon){
  const r = await fetch(
    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m`
  );
  const d = await r.json();
  weather.innerText = "Temperature: " + d.current.temperature_2m + " ¬∞C";
}

function calculateCost(){
  if(distanceKm === 0){
    alert("Please find route first");
    return;
  }

  const mileage = +mileage.value;
  const fuelP = +fuelPrice.value;
  const trav = +travellers.value;
  const rate = +hotelRate.value;
  const nightsV = +nights.value;
  const foodP = +food.value;
  const extra = +extras.value;

  const fuelNeeded = distanceKm / mileage;
  const transport = fuelNeeded * fuelP;
  const rooms = Math.ceil(trav / 2);
  const stay = rooms * nightsV * rate;
  const foodCost = trav * nightsV * foodP;

  const total = transport + stay + foodCost + extra;

  rDist.innerText = distanceKm.toFixed(1);
  rFuel.innerText = fuelNeeded.toFixed(1);
  rTransport.innerText = transport.toFixed(0);
  rStay.innerText = stay;
  rFood.innerText = foodCost;
  rExtra.innerText = extra;
  rTotal.innerText = total.toFixed(0);
  rPer.innerText = (total / trav).toFixed(0);

  resultCard.classList.remove("hidden");
}

function findHotels(){
  window.open(
    "https://www.google.com/maps/search/hotels+near+" + to.value
  );
}
</script>

</body>
</html>
""";
    }
}
