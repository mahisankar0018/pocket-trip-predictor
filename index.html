import com.sun.net.httpserver.HttpServer;
import java.io.OutputStream;
import java.net.InetSocketAddress;

public class TripCostEstimator {

    public static void main(String[] args) throws Exception {

        HttpServer server = HttpServer.create(new InetSocketAddress(8080), 0);

        server.createContext("/", exchange -> {
            String response = """
<!DOCTYPE html>
<html>
<head>
<title>Trip Cost Estimator</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{
    margin:0;
    font-family:Arial;
    background:linear-gradient(120deg,#0f172a,#1e293b);
    color:white;
}
.container{
    max-width:1000px;
    margin:20px auto;
    background:#020617;
    padding:20px;
    border-radius:12px;
}
h1{text-align:center;color:#22c55e;}
input,select{
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:6px;
    border:none;
}
button{
    width:100%;
    padding:12px;
    background:#22c55e;
    border:none;
    font-size:16px;
    font-weight:bold;
    border-radius:8px;
    cursor:pointer;
}
#map{
    height:350px;
    margin-top:15px;
    border-radius:10px;
}
.result{
    margin-top:20px;
    background:#020617;
    padding:15px;
    border-radius:10px;
    font-size:18px;
}
</style>
</head>

<body>
<div class="container">
<h1>Trip Cost Estimator</h1>

<label>Origin</label>
<input id="from" placeholder="Enter starting place">

<label>Destination</label>
<input id="to" placeholder="Enter destination place">

<label>Travel Mode</label>
<select id="mode">
<option value="car">Car</option>
<option value="bike">Bike</option>
<option value="train">Train</option>
<option value="flight">Flight</option>
</select>

<label>No. of Days</label>
<input type="number" id="days" value="1">

<label>No. of Persons</label>
<input type="number" id="persons" value="1">

<label>Hotel cost per day (₹)</label>
<input type="number" id="hotel" value="1000">

<label>Food cost per day (₹)</label>
<input type="number" id="food" value="500">

<button onclick="calculate()">Calculate Trip Cost</button>

<div id="map"></div>

<div class="result" id="result"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map = L.map('map').setView([20.5937,78.9629],5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let markers=[];

async function getCoords(place){
    let res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${place}`);
    let data = await res.json();
    return [data[0].lat, data[0].lon];
}

async function calculate(){
    let from = document.getElementById("from").value;
    let to = document.getElementById("to").value;
    let mode = document.getElementById("mode").value;
    let days = +document.getElementById("days").value;
    let persons = +document.getElementById("persons").value;
    let hotel = +document.getElementById("hotel").value;
    let food = +document.getElementById("food").value;

    if(!from || !to){ alert("Enter origin and destination"); return; }

    let c1 = await getCoords(from);
    let c2 = await getCoords(to);

    map.setView(c1,6);
    markers.forEach(m=>map.removeLayer(m));
    markers=[];

    let m1 = L.marker(c1).addTo(map).bindPopup("Origin").openPopup();
    let m2 = L.marker(c2).addTo(map).bindPopup("Destination");
    markers.push(m1,m2);

    let distance = map.distance(c1,c2)/1000;

    let perKm = {car:8,bike:3,train:2,flight:6}[mode];
    let travelCost = distance * perKm;
    let hotelCost = hotel * days * persons;
    let foodCost = food * days * persons;
    let total = travelCost + hotelCost + foodCost;

    document.getElementById("result").innerHTML = `
        Distance: <b>${distance.toFixed(2)} km</b><br>
        Travel Cost: ₹${travelCost.toFixed(0)}<br>
        Hotel Cost: ₹${hotelCost}<br>
        Food Cost: ₹${foodCost}<br><hr>
        <b>Total Trip Cost: ₹${total.toFixed(0)}</b>
    `;
}
</script>

</body>
</html>
""";

            exchange.sendResponseHeaders(200, response.length());
            OutputStream os = exchange.getResponseBody();
            os.write(response.getBytes());
            os.close();
        });

        server.start();
        System.out.println("Trip Cost Estimator running at http://localhost:8080");
    }
}
