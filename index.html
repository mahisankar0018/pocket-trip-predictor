package com.tripcost;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@SpringBootApplication
public class TripCostEstimatorApplication {
    public static void main(String[] args) {
        SpringApplication.run(TripCostEstimatorApplication.class, args);
    }
}

@RestController
class TripUIController {

    @GetMapping("/")
    public String home() {
        return """
<!DOCTYPE html>
<html>
<head>
<title>Trip Cost Estimator</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white}
h1{text-align:center;padding:10px}
.card{background:#1e293b;margin:15px;padding:15px;border-radius:10px}
input,button{padding:10px;width:95%;margin:5px}
button{background:#22c55e;border:none;font-weight:bold;cursor:pointer}
#map{height:400px;margin:15px;border-radius:10px}
</style>
</head>

<body>

<h1>Trip Cost Estimator</h1>

<div class="card">
<input id="from" placeholder="From (Hyderabad)">
<input id="to" placeholder="To (Bengaluru)">
<button onclick="findRoute()">Find Route</button>
<p>Distance: <span id="distance">0</span> km</p>
</div>

<div class="card">
<h3>üå§ Weather</h3>
<div id="weather">No data</div>
</div>

<div class="card">
<button onclick="findHotels()">üè® Find Hotels Near Destination</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map=L.map("map").setView([20.5937,78.9629],5);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
let routeLayer;

async function geo(place){
 const r=await fetch("https://nominatim.openstreetmap.org/search?format=json&q="+place);
 const d=await r.json();
 return {lat:+d[0].lat,lon:+d[0].lon};
}

async function findRoute(){
 const A=await geo(from.value);
 const B=await geo(to.value);

 const r=await fetch(
 "https://router.project-osrm.org/route/v1/driving/"
 +A.lon+","+A.lat+";"+B.lon+","+B.lat+
 "?overview=full&geometries=geojson"
 );
 const data=await r.json();
 const route=data.routes[0];

 distance.innerText=(route.distance/1000).toFixed(1);

 if(routeLayer) map.removeLayer(routeLayer);
 routeLayer=L.geoJSON(route.geometry).addTo(map);
 map.fitBounds(routeLayer.getBounds());

 loadWeather(B.lat,B.lon);
}

async function loadWeather(lat,lon){
 const r=await fetch(
 "https://api.open-meteo.com/v1/forecast?latitude="+lat+
 "&longitude="+lon+"&current=temperature_2m"
 );
 const d=await r.json();
 weather.innerText="Temperature: "+d.current.temperature_2m+" ¬∞C";
}

function findHotels(){
 window.open("https://www.google.com/maps/search/hotels+near+"+to.value);
}
</script>

</body>
</html>
""";
    }
}
