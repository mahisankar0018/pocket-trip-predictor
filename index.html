package com.tripcost;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@SpringBootApplication
public class TripCostEstimatorApplication {
    public static void main(String[] args) {
        SpringApplication.run(TripCostEstimatorApplication.class, args);
    }
}

@RestController
class TripUIController {

    @GetMapping("/")
    public String home() {
        return """
<!DOCTYPE html>
<html>
<head>
<title>Trip cost estimator</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body{margin:0;font-family:Inter,Arial;background:#020617;color:#e5e7eb}
h1{text-align:center;padding:14px}
.container{display:grid;grid-template-columns:1fr 1fr;gap:16px;padding:16px}
.card{background:#0f172a;border-radius:14px;padding:16px}
input,button{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:none}
button{background:#22c55e;color:#022c22;font-weight:bold;cursor:pointer}
#map{height:420px;border-radius:14px;margin:16px}
.row{display:flex;justify-content:space-between;margin:6px 0}
hr{border:0;border-top:1px dashed #334155;margin:10px 0}
</style>
</head>

<body>

<h1>Trip cost estimator</h1>

<div class="container">

<!-- LEFT -->
<div class="card">
<input id="from" placeholder="From (Hyderabad)">
<input id="to" placeholder="To (Bengaluru)">
<button onclick="findRoute()">Find Route</button>

<input id="mileage" type="number" value="18" placeholder="Mileage (km/L)">
<input id="fuelPrice" type="number" value="110" placeholder="Fuel price ‚Çπ/L">
<input id="travellers" type="number" value="2" placeholder="Travellers">
<input id="hotelRate" type="number" value="1500" placeholder="Hotel ‚Çπ/room/night">
<input id="nights" type="number" value="1" placeholder="Nights">
<input id="food" type="number" value="300" placeholder="Food ‚Çπ/person/day">
<input id="extras" type="number" value="0" placeholder="Extras">

<button onclick="calculate()">Calculate cost</button>
<button onclick="findHotels()">üè® Find Hotels</button>
</div>

<!-- RIGHT -->
<div class="card">
<h3>Trip budget overview</h3>

<div class="row"><span>Distance</span><span><b id="dist">0</b> km</span></div>
<div class="row"><span>Transport total</span><span>‚Çπ<b id="transport">0</b></span></div>
<div class="row"><span>Stay total</span><span>‚Çπ<b id="stay">0</b></span></div>
<div class="row"><span>Food total</span><span>‚Çπ<b id="foodTotal">0</b></span></div>
<div class="row"><span>Extras</span><span>‚Çπ<b id="extraTotal">0</b></span></div>
<div class="row"><span>Fuel needed</span><span><b id="fuelNeed">0</b> L</span></div>
<div class="row"><span>Rooms √ó nights</span><span><b id="rooms">0</b> √ó <b id="nightsOut">0</b></span></div>

<hr>

<div class="row"><span><b>Grand total</b></span><span>‚Çπ<b id="grand">0</b></span></div>
<div class="row"><span><b>Per person</b></span><span>‚Çπ<b id="per">0</b></span></div>

<hr>
<h4>üå§ Weather</h4>
<div id="weather">No data</div>
</div>

</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map=L.map("map").setView([20.5937,78.9629],5);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
let routeLayer;

async function geo(p){
 const r=await fetch("https://nominatim.openstreetmap.org/search?format=json&q="+p);
 const d=await r.json();
 return {lat:+d[0].lat,lon:+d[0].lon};
}

async function findRoute(){
 const A=await geo(from.value);
 const B=await geo(to.value);

 const r=await fetch(
 "https://router.project-osrm.org/route/v1/driving/"
 +A.lon+","+A.lat+";"+B.lon+","+B.lat+
 "?overview=full&geometries=geojson"
 );
 const data=await r.json();
 const route=data.routes[0];

 const km=(route.distance/1000).toFixed(1);
 dist.innerText=km;

 if(routeLayer) map.removeLayer(routeLayer);
 routeLayer=L.geoJSON(route.geometry).addTo(map);
 map.fitBounds(routeLayer.getBounds());

 loadWeather(B.lat,B.lon);
}

async function loadWeather(lat,lon){
 const r=await fetch(
 "https://api.open-meteo.com/v1/forecast?latitude="+lat+
 "&longitude="+lon+"&current=temperature_2m"
 );
 const d=await r.json();
 weather.innerText="Temperature: "+d.current.temperature_2m+" ¬∞C";
}

function calculate(){
 const distance=+dist.innerText||0;
 const mileage=+mileage.value;
 const fuelP=+fuelPrice.value;
 const trav=+travellers.value;
 const rate=+hotelRate.value;
 const n=+nights.value;
 const foodP=+food.value;
 const extra=+extras.value;

 const fuelNeeded=(distance/mileage);
 const transport=fuelNeeded*fuelP;
 const rooms=Math.ceil(trav/2);
 const stay=rooms*n*rate;
 const foodCost=trav*n*foodP;
 const total=transport+stay+foodCost+extra;

 fuelNeed.innerText=fuelNeeded.toFixed(1);
 transport.innerText=transport.toFixed(0);
 stay.innerText=stay;
 foodTotal.innerText=foodCost;
 extraTotal.innerText=extra;
 rooms.innerText=rooms;
 nightsOut.innerText=n;
 grand.innerText=total.toFixed(0);
 per.innerText=(total/trav).toFixed(0);
}

function findHotels(){
 window.open("https://www.google.com/maps/search/hotels+near+"+to.value);
}
</script>

</body>
</html>
""";
    }
}
